<style>
	sup { vertical-align: super; }
	sub { vertical-align: sub; }
</style>

<div layout="column" layout-fill flex>
	<div ng-include="'app/components/navbar/navbar.html'"></div>

	<div layout="row" flex style="height: 0; overflow: scroll;">
		<md-sidenav class="md-sidenav-left md-whiteframe-z2 edit-exam-sidenav" md-component-id="left" md-is-locked-open="$mdMedia('gt-md')" layout="column">
			<div flex>
				<div layout="row" layout-align="space-between center">
					<md-button class="md-raised" ng-click="saveExam()" ng-disabled="!has_changed" aria-label="Speichern">
						<span ng-if="has_changed">Speichern</span>
						<span ng-if="!has_changed">Gespeichert</span>
					</md-button>
					<md-button ng-click="addQuestion(true)"><i class="fa fa-fw fa-plus"></i> Frage</md-button>
				</div>

				<md-list>
					<md-divider></md-divider>

					<md-list-item ng-click="showInfo()" ng-class="{'active': active == 'tab'}" aria-label="Infos anzeigen">
						<div class="md-list-item-text" layout="column" layout-align="center start">
							<span class="md-title">Allgemeine Infos</span>

							<section class="md-body-2" style="margin-top: -4px; padding-bottom: 4px;">
								<i class="fa fa-fw fa-flask"></i> {{ getNameOfSubjectID(exam.subject_id) }}
								<i class="fa fa-fw fa-calendar"></i> {{ exam.date }}
							</section>
						</div>
					</md-list-item>

					<md-divider></md-divider>

					<!--md-subheader class="md-no-sticky">{{ exam.questions.length }} Fragen</md-subheader-->

					<md-list-item ng-repeat-start="q in exam.questions" ng-click="showQuestion($index)" ng-class="{'active': active == $index}" aria-label="Frage anzeigen">
						<p style="font-size: 14px; line-height: 18px;">
							<span ng-bind-html="q.question |Â limitTo:60" ng-if="q.question"></span>
							<span ng-if="!q.question"><i>Neue Frage...</i></span>
						</p>
					</md-list-item>
					<md-divider ng-if="!$last" ng-repeat-end></md-divider>
				</md-list>
			</div>
		</md-sidenav>

	  <div layout="column" flex style="overflow: scroll;">
	    <div layout="column"  style="min-height: 600px;" flex layout-padding>

				<div>
          <md-button ng-click="toggleLeft()"
            class="md-primary" hide-gt-md>
            Fragenleiste einblenden
          </md-button>
        </div>

				<div class="edit-exam-question" ng-if="active == 'tab'" id="edit-exam">
					<form name="examInfoForm">
						<div layout="row" layout-align="start start">
							<span flex="20" class="form-left-label" style="padding-top: 16px;">Allgemeine Informationen</span>
							<div layout="row" flex layout-wrap>
								<md-input-container  flex="50">
									<label>Semester</label>
									<input type="number" ng-model="exam.semester" min="1" max="20" required name="semester">
									<div ng-messages="examInfoForm.semester.$error" ng-if="examInfoForm.semester.$dirty">
										<div ng-message="required">Bitte Semester angeben...</div>
										<div ng-message="number">Bitte Zahl angeben</div>
										<div ng-message="min">So fr&uuml;h schon?</div>
										<div ng-message="max">So hohes Semester?</div>
									</div>
								</md-input-container>

								<md-select placeholder="Fach" ng-model="exam.subject_id" required name="subject_id" flex="50">
									<md-option ng-repeat="subject in subjects" value="{{ subject.subject_id }}">{{ subject.name }}</md-option>
								</md-select>

								<md-input-container flex="50">
									<label>Termin (z.B. WS 2010/11)</label>
									<input type="text" ng-model="exam.date" required name="date">
									<div ng-messages="examInfoForm.date.$error" ng-if="examInfoForm.date.$dirty">
		                <div ng-message="required">Bitte Termin angeben...</div>
		              </div>
								</md-input-container>

								<md-select placeholder="Art" ng-model="exam.sort" required flex="50">
									<md-option value='Erstklausur'>Erstklausur</md-option>
									<md-option value='Wiederholungsklausur'>Wiederholungsklausur</md-option>
									<md-option value='Leistungskontrolle'>Leistungskontrolle</md-option>
									<md-option value='Fragensammlung'>Fragensammlung</md-option>
									<md-option value='Testat'>Testat</md-option>
									<md-option value='Sonstiges'>Sonstiges</md-option>
								</md-select>
							</div>
						</div>

						<div layout="row" layout-align="start start">
							<span flex="20" class="form-left-label" style="padding-top: 16px;">Zus&auml;tzliche Informationen</span>
							<div layout="column" flex>
								<md-input-container>
									<label>Professor_in</label>
									<input type="text" ng-model="exam.professor">
								</md-input-container>

								<md-input-container>
									<label>Bearbeitungszeit (Minuten)</label>
									<input type="text" ng-model="exam.duration">
								</md-input-container>
							</div>
						</div>

						<div layout="row" layout-align="start start">
							<span flex="20" class="form-left-label" style="padding-top: 6px;">Anmerkungen</span>
							<div flex>
								<md-input-container>
									<textarea rows="3"  ng-model="exam.notes" aria-label="Anmerkungen"></textarea>
								</md-input-container>
							</div>
						</div>
					</form>

					<md-divider></md-divider>

					<div layout="row" layout-align="start start" style="margin-top: 20px;">
						<span flex="20" class="form-left-label" style="padding-top: 2px;">Originaldokument</span>
						<div flex>
							<!--div style="margin-bottom: 10px;">
								<input type="file" nv-file-select uploader="uploader" accept="application/pdf"/><br/>
								<a href="http://www.crucio-leipzig.de/public/files/{{ exam.file_name }}" target="_self" ng-show="exam.file_name">
									<i class="fa fa-external-link fa-fw"></i> Originaldokument
								</a>
							</div>

							<md-button ng-disabled="uploader.queue.length == 0" ng-click="uploader.queue[uploader.queue.length-1].upload()">
								<i class="fa fa-fw fa-upload"></i> Hochladen
							</md-button-->

							<md-button class="button" ngf-select ngf-change="uploadPDF($files)" ngf-accept="'application/pdf'">
								<i class="fa fa-fw fa-upload"></i> Datei hochladen
							</md-button>

							<md-button ng-click="exam.file_name=''" ng-disabled="!exam.file_name">Datei l&ouml;schen</md-button>
						</div>
					</div>


					<md-divider></md-divider>

					<div layout="row" layout-align="start start" style="padding: 10px;">
						<span flex="20" class="form-left-label"></span>
						<div flex>
							<md-switch ng-model="exam.visibility">
								Sichtbar
							</md-switch>
						</div>
					</div>

					<div layout="row" layout-align="start start" style="padding: 10px;">
						<span flex="20" class="form-left-label">Anzahl Fragen</span>
						<div flex>
							<div ng-bind="exam.questions.length"></div>
						</div>
					</div>

					<div layout="row" layout-align="start start" style="padding: 10px;">
						<span flex="20" class="form-left-label">Autor</span>
						<div flex>
							<div>{{ exam.username }}</div>
						</div>
					</div>

					<div layout="row" layout-align="start start" style="padding: 10px;">
						<span flex="20" class="form-left-label">Eingetragen</span>
						<div flex>
							<div>{{ exam.date_added * 1000 | date:'dd.MM.yyyy' }}</div>
						</div>
					</div>

					<div layout="row" layout-align="start start" style="padding: 10px; margin-bottom: 20px;">
						<span flex="20" class="form-left-label">Aktualisiert</span>
						<div flex>
							<div>{{ exam.date_updated * 1000 | date:'dd.MM.yyyy, HH:mm' }} Uhr</div>
						</div>
					</div>

					<md-divider></md-divider>

					<div layout="row" layout-align="start start" style="padding-top: 20px; padding-bottom: 20px;">
						<span flex="20" class="form-left-label"></span>
						<div flex>
							<md-button class="md-raised md-warn" ng-click="openDeleteExamDialog()">Klausur l&ouml;schen</md-button>
						</div>
					</div>
				</div>



				<div class="edit-exam-question" ng-if="active != 'tab'" id="edit-question">
					<div layout="row" layout-align="start start" style="padding-bottom: 10px;">
						<span flex="20" class="form-left-label" style="padding-top: 16px;">Typ</span>
						<div flex>
							<md-radio-group ng-model="q.type" layout="row" layout-sm="column">
					      <md-radio-button value="1">Freie Frage</md-radio-button>
								<md-radio-button value="2">2</md-radio-button>
								<md-radio-button value="3">3</md-radio-button>
								<md-radio-button value="4">4</md-radio-button>
								<md-radio-button value="5">5</md-radio-button>
								<md-radio-button value="6">6 Antworten</md-radio-button>
					    </md-radio-group>
						</div>
					</div>

					<md-divider></md-divider>

					<div layout="row" layout-align="start start">
						<span flex="20" class="form-left-label" style="padding-top: 32px;">Kategorie</span>
						<div flex>
							<md-select placeholder="Kategorie" ng-model="q.topic">
								<md-option ng-if="q.topic != 'Sonstiges'" ng-value="Sonstiges">Sonstiges</md-option>
								<md-option ng-if="subject_list[exam.subject].indexOf(q.topic) == -1" ng-value="q.topic">{{ q.topic }}</md-option>
								<md-option ng-repeat="c in getCategoriesOfSubjectID(exam.subject_id)">{{ c.name }}</md-option>
							</md-select>
						</div>
					</div>

					<md-divider></md-divider>

					<div layout="row" layout-align="start start" style="padding-top: 20px; paddint-bottom: 20px;">
						<span flex="20" class="form-left-label">Frage</span>
						<div flex>
							<text-angular ng-model="q.question" ta-disabled="false" ta-toolbar="[['bold','italics', 'subscript', 'superscript'], ['ul', 'ol'], ['times', 'sdot', 'asymp', 'radic'], ['arrow-left', 'arrow-right', 'arrow-left-right'], ['alpha', 'beta', 'gamma', 'delta', 'lambda', 'mu', 'pi', 'rho', 'omega', 'Omega'], ['undo', 'redo']]" class="text-angular-large"></text-angular>

							<div style="margin-bottom: 10px;">
									<!--input type="file" nv-file-select uploader="uploader_array[$index]" accept="image/jpeg, image/png"/><br/>
									<md-button ng-disabled="uploader_array[$index].queue.length == 0" ng-click="uploader_array[$index].queue[0].upload()">
										<i class="fa fa-fw fa-upload"></i> Hochladen
									</md-button>
									<md-button ng-click="q.question_image_url=''">Bild l&ouml;schen</md-button-->

									<md-button class="button" ngf-select ngf-change="uploadImage($files)" ngf-accept="'image/*'">
										<i class="fa fa-fw fa-upload"></i> Bild hochladen
									</md-button>

									<md-button ng-click="q.question_image_url=''" ng-disabled="!q.question_image_url">Bild l&ouml;schen</md-button>
							</div>

							<img ng-if="q.question_image_url" class="img-thumbnail questionImagePreview" src="/public/files/{{ q.question_image_url }}" />
						</div>
					</div>

					<md-divider></md-divider>

					<div layout="row" layout-align="start start" style="padding-top: 20px; paddint-bottom: 20px;">
						<span flex="20" class="form-left-label">Antworten</span>
						<div flex>
							<text-angular-toolbar name="toolbarf" ta-toolbar="[['subscript', 'superscript'], ['times', 'sdot', 'asymp', 'radic'], ['alpha', 'beta', 'gamma', 'delta', 'lambda', 'mu', 'pi', 'rho', 'omega', 'Omega']]"></text-angular-toolbar>
						</div>
					</div>

					<div layout="row" layout-align="start start" ng-repeat="i in [1,2,3,4,5,6]" ng-show="i - 1 < q.type">
						<span flex="20" class="form-left-label" style="padding-top: 16px;">
							<span class="answer" ng-class="{'success-answer': i == q.correct_answer}">Antwort <span ng-show="q.type > 1">{{ i }}</span></span>
						</span>
						<div flex>
							<text-angular ng-model="q.answers[i-1]" ta-disabled="false" ta-target-toolbars="toolbarf"></text-angular>
						</div>
					</div>

					<div layout="row" layout-align="start start" ng-if="q.type > 1">
						<span flex="20" class="form-left-label" style="padding-top: 16px;">L&ouml;sung</span>
						<div flex>
							<md-radio-group ng-model="q.correct_answer" layout="row" layout-sm="column">
								<md-radio-button value="0">Unbekannt</md-radio-button>
								<md-radio-button value="{{ i }}" ng-if="i - 1 < q.type" ng-repeat="i in [1,2,3,4,5,6]">{{ i }}</md-radio-button>
							</md-radio-group>
						</div>
					</div>

					<md-divider></md-divider>

					<div layout="row" layout-align="start start" style="padding-top: 20px; paddint-bottom: 20px;">
						<span flex="20" class="form-left-label" style="padding-top: 6px;">Erkl&auml;rung</span>
						<div flex>
							<text-angular ng-model="q.explanation" ta-disabled="false" ta-toolbar="[['bold','italics', 'subscript', 'superscript'], ['ul', 'ol'], ['times', 'sdot', 'asymp', 'radic'], ['arrow-left', 'arrow-right', 'arrow-left-right'], ['alpha', 'beta', 'gamma', 'delta', 'lambda', 'mu', 'pi', 'rho', 'omega', 'Omega'], ['undo', 'redo']]" class="text-angular-large"></text-angular>
						</div>
					</div>

					<md-divider></md-divider>

					<div layout="row" layout-align="start start" style="padding-top: 20px; padding-bottom: 20px;">
						<span flex="20" class="form-left-label" style="padding-top: 16px;"></span>
						<div flex>
							<md-button class="md-warn md-raised" ng-click="deleteQuestion(active)"><i class="fa fa-trash-o"></i> Frage l&ouml;schen</md-button>
						</div>
					</div>
	      </div>
			</div>
	  </div>
	</div>

	<div ng-include="'app/components/footer/footer.html'"></div>
</div>
